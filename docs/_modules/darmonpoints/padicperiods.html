<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>darmonpoints.padicperiods - darmonpoints 7.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="https://doc.sagemath.org/html/en/reference/_static/custom-furo.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #0f0fff;
  --color-brand-content: #0f0fff;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">darmonpoints 7.0.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../_static/logo.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../_static/logo.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">darmonpoints 7.0.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../highlevel.html">Darmon points</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../highlevel.html#module-darmonpoints.darmonvonk">Darmon-Vonk points</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../highlevel.html#module-darmonpoints.findcurve">Curve finding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../highlevel.html#module-darmonpoints.padicperiods">p-adic periods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../highlevel.html#module-darmonpoints.plectic">Plectic points</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../highlevel.html#schottky-groups">Schottky groups</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arithmeticgroups.html">Arithmetic group elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arithmeticgroups.html#module-darmonpoints.arithgroup_nscartan">Non-split Cartan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arithmeticgroups.html#module-darmonpoints.arithgroup">Arithmetic group</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arithmeticgroups.html#module-darmonpoints.sarithgroup">S-arithmetic group</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cohomology.html">Abstract cohomology class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cohomology.html#module-darmonpoints.cohomology_arithmetic">Arithmetic cohomology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cohomology.html#module-darmonpoints.homology_abstract">Abstract homology class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cohomology.html#module-darmonpoints.homology">Homology class</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../integration.html">Integrals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integration.html#module-darmonpoints.limits">Limits</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../distributions.html">Overconvergent module of distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../distributions.html#module-darmonpoints.representations">Representations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../distributions.html#module-darmonpoints.meromorphic">Meromorphic functions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../internals.html">Divisors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internals.html#module-darmonpoints.mixed_extension">Mixed extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internals.html#module-darmonpoints.sparse">Sparse matrix calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internals.html#module-darmonpoints.util">Utility package</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for darmonpoints.padicperiods</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">configparser</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span><span class="p">,</span> <span class="n">groupby</span><span class="p">,</span> <span class="n">islice</span><span class="p">,</span> <span class="n">product</span><span class="p">,</span> <span class="n">starmap</span><span class="p">,</span> <span class="n">tee</span>

<span class="kn">import</span> <span class="nn">pyximport</span>
<span class="kn">from</span> <span class="nn">sage.matrix.constructor</span> <span class="kn">import</span> <span class="n">Matrix</span><span class="p">,</span> <span class="n">block_diagonal_matrix</span><span class="p">,</span> <span class="n">block_matrix</span><span class="p">,</span> <span class="n">matrix</span>
<span class="kn">from</span> <span class="nn">sage.misc.banner</span> <span class="kn">import</span> <span class="n">version</span> <span class="k">as</span> <span class="n">sage_version</span>
<span class="kn">from</span> <span class="nn">sage.misc.persist</span> <span class="kn">import</span> <span class="n">db</span>
<span class="kn">from</span> <span class="nn">sage.modules.fg_pid.fgp_module</span> <span class="kn">import</span> <span class="n">FGP_Module</span><span class="p">,</span> <span class="n">FGP_Module_class</span>
<span class="kn">from</span> <span class="nn">sage.rings.integer_ring</span> <span class="kn">import</span> <span class="n">ZZ</span>
<span class="kn">from</span> <span class="nn">sage.rings.padics.precision_error</span> <span class="kn">import</span> <span class="n">PrecisionError</span>

<span class="kn">from</span> <span class="nn">.cohomology_arithmetic</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.homology</span> <span class="kn">import</span> <span class="n">get_homology_kernel</span><span class="p">,</span> <span class="n">inverse_shapiro</span><span class="p">,</span> <span class="n">lattice_homology_cycle</span>
<span class="kn">from</span> <span class="nn">.integrals</span> <span class="kn">import</span> <span class="n">integrate_H1</span>
<span class="kn">from</span> <span class="nn">.sarithgroup</span> <span class="kn">import</span> <span class="n">BigArithGroup</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">pyximport</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">.mixed_extension</span> <span class="kn">import</span> <span class="n">QuadExt</span>


<div class="viewcode-block" id="precompute_powers">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.precompute_powers">[docs]</a>
<span class="k">def</span> <span class="nf">precompute_powers</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">irange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pdict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">p</span><span class="o">**-</span><span class="mi">1</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">pdict</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span>
        <span class="n">tmpinv</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">**-</span><span class="mi">1</span>
        <span class="n">pdict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
        <span class="n">pdict</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmpinv</span>
        <span class="n">pdict</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">tmp</span>
        <span class="n">pdict</span><span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdict</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">tmpinv</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">pdict</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">pdict</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">i</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pdict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
            <span class="n">pdict</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdict</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">pdict</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">pdict</span></div>



<span class="c1"># Theta functions of (25) in Teitelbaum&#39;s</span>
<span class="c1"># and also the other theta functions that we need to compute the lambda&#39;s according to the formulas (23)</span>
<span class="c1"># We sum terms until we get the result to the accuracy prec. When deciding the set of indicies over which we sum, we have made several simplifications that probably cause that we sum more terms than strictly needed for that accuracy, but this probably won&#39;t be an issue...</span>
<div class="viewcode-block" id="Thetas">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.Thetas">[docs]</a>
<span class="k">def</span> <span class="nf">Thetas</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">prec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p1</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">precision_cap</span><span class="p">()</span>
    <span class="n">imax</span> <span class="o">=</span> <span class="p">(</span><span class="n">RR</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">RR</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">prec</span> <span class="o">+</span> <span class="n">RR</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">())</span><span class="o">.</span><span class="n">ceiling</span><span class="p">()</span>  <span class="c1"># note the 2!</span>
    <span class="k">if</span> <span class="n">imax</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">imax</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">QQ</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">QQ</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Define the different conditions and term forms</span>
    <span class="n">resdict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1p1m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1p2m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2p2m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1m2p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3p3m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2m3p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2p3m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3m1p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3p1m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">imax</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">jdict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">p1dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">p3dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">p2dict</span> <span class="o">=</span> <span class="n">precompute_powers</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">imax</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">imax</span><span class="p">,</span> <span class="n">imax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">newjmax</span> <span class="o">=</span> <span class="n">RR</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">prec</span> <span class="o">-</span> <span class="mf">0.25</span> <span class="o">-</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">RR</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">newjmax</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">newjmax</span> <span class="o">=</span> <span class="p">(</span><span class="n">newjmax</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">ceiling</span><span class="p">()</span>
            <span class="n">jdict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">newjmax</span>
            <span class="n">jrange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">newjmax</span><span class="p">,</span> <span class="n">newjmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">jlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">([</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jrange</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jrange</span><span class="p">])</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span>
                    <span class="nb">set</span><span class="p">(</span><span class="n">p1dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">klist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span>
                    <span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jrange</span><span class="p">]</span>
                    <span class="o">+</span> <span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jrange</span><span class="p">]</span>
                    <span class="o">+</span> <span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jrange</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">p3dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jlist</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">**</span> <span class="n">QQ</span><span class="p">(</span><span class="n">j</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">floor</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">*=</span> <span class="n">p1</span>
                <span class="n">p1dict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">klist</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">**</span> <span class="n">QQ</span><span class="p">(</span><span class="n">k</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">floor</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">*=</span> <span class="n">p3</span>
                <span class="n">p3dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">jmax</span> <span class="ow">in</span> <span class="n">jdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">jmax</span><span class="p">,</span> <span class="n">jmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">p1dict</span><span class="p">[</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">p2dict</span><span class="p">[</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">p3dict</span><span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)]</span>
            <span class="n">p11</span> <span class="o">=</span> <span class="n">p1dict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">p22</span> <span class="o">=</span> <span class="n">p2dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">p33</span> <span class="o">=</span> <span class="n">p3dict</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">p33</span> <span class="o">*</span> <span class="n">P</span>
            <span class="n">p2l_inv_p1l_inv_term</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">p22p11</span> <span class="o">=</span> <span class="n">p22</span> <span class="o">*</span> <span class="n">p11</span>
            <span class="n">newterm</span> <span class="o">=</span> <span class="n">p22p11</span> <span class="o">*</span> <span class="n">a</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">p22p11</span> <span class="o">*</span> <span class="n">P</span>
            <span class="n">p2lp3l_term</span> <span class="o">=</span> <span class="n">p22</span> <span class="o">*</span> <span class="n">p33</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b</span>
            <span class="n">p1lp3l_inv_term</span> <span class="o">=</span> <span class="n">p11</span> <span class="o">*</span> <span class="n">b</span>

            <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1p2m&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p2l_inv_p1l_inv_term</span>
            <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2p3m&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p2lp3l_term</span>
            <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3p1m&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p1lp3l_inv_term</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1p1m&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">newterm</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2m3p&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p2lp3l_term</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1p1m&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">newterm</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2m3p&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">p2lp3l_term</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2p2m&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">newterm</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3m1p&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p1lp3l_inv_term</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2p2m&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">newterm</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3m1p&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">p1lp3l_inv_term</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1m2p&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p2l_inv_p1l_inv_term</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3p3m&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">newterm</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1m2p&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">p2l_inv_p1l_inv_term</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3p3m&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">newterm</span>
    <span class="k">return</span> <span class="n">resdict</span></div>



<div class="viewcode-block" id="Theta">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.Theta">[docs]</a>
<span class="k">def</span> <span class="nf">Theta</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">prec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p1</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">precision_cap</span><span class="p">()</span>
    <span class="n">imax</span> <span class="o">=</span> <span class="p">(</span><span class="n">RR</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">RR</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">prec</span> <span class="o">+</span> <span class="n">RR</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">())</span><span class="o">.</span><span class="n">ceiling</span><span class="p">()</span>  <span class="c1"># note the 2!</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">QQ</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">QQ</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Define the different conditions and term forms</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
            <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">())</span>
            <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">())</span>
            <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="n">resdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1p1m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1p2m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2p2m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1m2p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3p3m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2m3p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2p3m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3m1p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3p1m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;1p1m&quot;</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">b</span> <span class="o">*</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">term</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">j</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;1p2m&quot;</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">term</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">p2</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">j</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;2p2m&quot;</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">b</span> <span class="o">*</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">term</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">i</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;1m2p&quot;</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">term</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">p2</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;3p3m&quot;</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">b</span> <span class="o">*</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">term</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;2m3p&quot;</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
            <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">term</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">p2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">p3</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">j</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;2p3m&quot;</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
            <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">term</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">p2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">p3</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;3m1p&quot;</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
            <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">b</span> <span class="o">*</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">term</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">p1</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">p3</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">i</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;3p1m&quot;</span><span class="p">:</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span>
            <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">b</span> <span class="o">*</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">term</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">p1</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">p3</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Wrong version? version = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">version</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">imax</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">imax</span><span class="p">,</span> <span class="n">imax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">jmax</span> <span class="o">=</span> <span class="n">RR</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">prec</span> <span class="o">-</span> <span class="mf">0.25</span> <span class="o">-</span> <span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">RR</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">jmax</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">jmax</span> <span class="o">=</span> <span class="p">(</span><span class="n">jmax</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">ceiling</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">jmax</span><span class="p">,</span> <span class="n">jmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">newterm</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">**</span> <span class="p">(</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">p3</span> <span class="o">**</span> <span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">p1l</span> <span class="o">=</span> <span class="n">p1</span><span class="o">**</span><span class="n">j</span>
                <span class="n">p2l</span> <span class="o">=</span> <span class="n">p2</span><span class="o">**</span><span class="n">i</span>
                <span class="n">p3l</span> <span class="o">=</span> <span class="n">p3</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span>
                <span class="n">p2l_inv_p1l_inv_term</span> <span class="o">=</span> <span class="n">newterm</span> <span class="o">*</span> <span class="p">(</span><span class="n">p2l</span> <span class="o">*</span> <span class="n">p1l</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">p2lp3l_term</span> <span class="o">=</span> <span class="n">newterm</span> <span class="o">*</span> <span class="n">p2l</span> <span class="o">*</span> <span class="n">p3l</span>
                <span class="n">p1lp3l_inv_term</span> <span class="o">=</span> <span class="n">newterm</span> <span class="o">*</span> <span class="n">p1l</span> <span class="o">*</span> <span class="n">p3l</span><span class="o">**-</span><span class="mi">1</span>

                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1p1m&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">newterm</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">j</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1p2m&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p2l_inv_p1l_inv_term</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2p2m&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">newterm</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">i</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;1m2p&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p2l_inv_p1l_inv_term</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3p3m&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">newterm</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2m3p&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p2lp3l_term</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">j</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;2p3m&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p2lp3l_term</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3m1p&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p1lp3l_inv_term</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">i</span>
                <span class="n">resdict</span><span class="p">[</span><span class="s2">&quot;3p1m&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">p1lp3l_inv_term</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">newterm</span> <span class="o">*</span> <span class="n">term</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="lambdavec">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.lambdavec">[docs]</a>
<span class="k">def</span> <span class="nf">lambdavec</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prec_pseries</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">theta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">prec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">Thetas</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">theta</span>

    <span class="n">num</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;3p3m&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;2m3p&quot;</span><span class="p">]</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;2p2m&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;2p3m&quot;</span><span class="p">]</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="n">den</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;1p1m&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;3m1p&quot;</span><span class="p">]</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;3p3m&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;3p1m&quot;</span><span class="p">]</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="n">den</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;2p2m&quot;</span><span class="p">]</span>
    <span class="n">num</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">quo_rem</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">rem</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">num</span> <span class="o">*=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;1m2p&quot;</span><span class="p">]</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;1p1m&quot;</span><span class="p">]</span>
    <span class="n">den</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="n">den</span><span class="o">.</span><span class="n">quo_rem</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">rem</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">den</span> <span class="o">*=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;1p2m&quot;</span><span class="p">]</span>
    <span class="n">l3</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>
    <span class="n">l3</span> <span class="o">*=</span> <span class="n">l3</span>
    <span class="k">return</span> <span class="n">matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">l3</span><span class="p">])</span></div>



<div class="viewcode-block" id="lambdavec_padic">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.lambdavec_padic">[docs]</a>
<span class="k">def</span> <span class="nf">lambdavec_padic</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">th</span> <span class="o">=</span> <span class="n">Thetas</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;3p3m&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;2m3p&quot;</span><span class="p">]</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;2p2m&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;2p3m&quot;</span><span class="p">]</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="n">den</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;1p1m&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;3m1p&quot;</span><span class="p">]</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;3p3m&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;3p1m&quot;</span><span class="p">]</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="n">den</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;2p2m&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;1m2p&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p3</span><span class="p">)</span>  <span class="c1"># Watch</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;1p1m&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">th</span><span class="p">[</span><span class="s2">&quot;1p2m&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p3</span><span class="p">)</span>
    <span class="n">l3</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="n">den</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">l3</span><span class="p">])</span></div>



<div class="viewcode-block" id="xvec">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.xvec">[docs]</a>
<span class="k">def</span> <span class="nf">xvec</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">p1</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">p2</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">p3</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">]</span> <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">p2</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">p3</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;3&quot;</span><span class="p">)</span>
    <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">l3</span> <span class="o">=</span> <span class="n">lambdavec</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="n">x3</span> <span class="o">=</span> <span class="n">l3</span> <span class="o">*</span> <span class="p">((</span><span class="n">p3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">l2</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">den</span>
    <span class="n">den</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">l1</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">den</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)</span></div>



<div class="viewcode-block" id="xvec_padic">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.xvec_padic">[docs]</a>
<span class="k">def</span> <span class="nf">xvec_padic</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">p1</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">p2</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">p3</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">]</span> <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">p2</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">p3</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;3&quot;</span><span class="p">)</span>
    <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">l3</span> <span class="o">=</span> <span class="n">lambdavec_padic</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">l1</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">l2</span><span class="p">,</span> <span class="n">l3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">p3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">q3</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span></div>



<div class="viewcode-block" id="igusa_clebsch_absolute_from_half_periods">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.igusa_clebsch_absolute_from_half_periods">[docs]</a>
<span class="k">def</span> <span class="nf">igusa_clebsch_absolute_from_half_periods</span><span class="p">(</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">padic</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
    <span class="n">I2</span><span class="p">,</span> <span class="n">I4</span><span class="p">,</span> <span class="n">I6</span><span class="p">,</span> <span class="n">I10</span> <span class="o">=</span> <span class="n">igusa_clebsch_from_half_periods</span><span class="p">(</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">,</span> <span class="n">padic</span><span class="o">=</span><span class="n">padic</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">I2</span><span class="o">**</span><span class="mi">5</span> <span class="o">/</span> <span class="n">I10</span><span class="p">,</span> <span class="n">I2</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">I4</span> <span class="o">/</span> <span class="n">I10</span><span class="p">,</span> <span class="n">I2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">I6</span> <span class="o">/</span> <span class="n">I10</span></div>



<div class="viewcode-block" id="igusa_clebsch_from_half_periods">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.igusa_clebsch_from_half_periods">[docs]</a>
<span class="k">def</span> <span class="nf">igusa_clebsch_from_half_periods</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">padic</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">padic</span> <span class="ow">or</span> <span class="n">prec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">igusa_clebsch_from_xvec</span><span class="p">(</span><span class="n">xvec_padic</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">igusa_clebsch_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">prec</span><span class="p">))</span></div>



<div class="viewcode-block" id="igusa_clebsch_absolute_from_xvec">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.igusa_clebsch_absolute_from_xvec">[docs]</a>
<span class="k">def</span> <span class="nf">igusa_clebsch_absolute_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">):</span>
    <span class="n">I2</span><span class="p">,</span> <span class="n">I4</span><span class="p">,</span> <span class="n">I6</span><span class="p">,</span> <span class="n">I10</span> <span class="o">=</span> <span class="n">igusa_clebsch_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">I2</span><span class="o">**</span><span class="mi">5</span> <span class="o">/</span> <span class="n">I10</span><span class="p">,</span> <span class="n">I2</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">I4</span> <span class="o">/</span> <span class="n">I10</span><span class="p">,</span> <span class="n">I2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">I6</span> <span class="o">/</span> <span class="n">I10</span></div>



<div class="viewcode-block" id="I2_inv_from_xvec">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.I2_inv_from_xvec">[docs]</a>
<span class="k">def</span> <span class="nf">I2_inv_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">):</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span> <span class="o">=</span> <span class="n">xvec</span>
    <span class="n">x12</span><span class="p">,</span> <span class="n">x22</span><span class="p">,</span> <span class="n">x32</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span> <span class="o">*</span> <span class="n">x3</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="mi">6</span> <span class="o">*</span> <span class="p">((</span><span class="n">x12</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x22</span> <span class="o">+</span> <span class="n">x32</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span>
        <span class="o">*</span> <span class="p">(</span>
            <span class="n">x1</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">x3</span><span class="p">)</span> <span class="o">+</span> <span class="n">x1</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">+</span> <span class="n">x3</span><span class="p">)</span> <span class="o">+</span> <span class="n">x22</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">x3</span> <span class="o">*</span> <span class="p">(</span><span class="n">x22</span> <span class="o">+</span> <span class="n">x3</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span> <span class="o">+</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="j1_inv_from_xvec">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.j1_inv_from_xvec">[docs]</a>
<span class="k">def</span> <span class="nf">j1_inv_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">):</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span> <span class="o">=</span> <span class="n">xvec</span>
    <span class="n">x12</span><span class="p">,</span> <span class="n">x22</span><span class="p">,</span> <span class="n">x32</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span> <span class="o">*</span> <span class="n">x3</span>
    <span class="n">I2</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">6</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x22</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x2</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x22</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x12</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span>
        <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x22</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x32</span>
    <span class="p">)</span>
    <span class="n">I10</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">x12</span>
        <span class="o">*</span> <span class="n">x22</span>
        <span class="o">*</span> <span class="n">x32</span>
        <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x3</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">I2</span><span class="o">**</span><span class="mi">5</span> <span class="o">/</span> <span class="n">I10</span></div>



<div class="viewcode-block" id="igusa_clebsch_from_xvec">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.igusa_clebsch_from_xvec">[docs]</a>
<span class="k">def</span> <span class="nf">igusa_clebsch_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">):</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span> <span class="o">=</span> <span class="n">xvec</span>
    <span class="n">x12</span><span class="p">,</span> <span class="n">x22</span><span class="p">,</span> <span class="n">x32</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span> <span class="o">*</span> <span class="n">x3</span>
    <span class="n">x13</span><span class="p">,</span> <span class="n">x23</span><span class="p">,</span> <span class="n">x33</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x12</span><span class="p">,</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x22</span><span class="p">,</span> <span class="n">x3</span> <span class="o">*</span> <span class="n">x32</span>
    <span class="n">x14</span><span class="p">,</span> <span class="n">x24</span><span class="p">,</span> <span class="n">x34</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x13</span><span class="p">,</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x23</span><span class="p">,</span> <span class="n">x3</span> <span class="o">*</span> <span class="n">x33</span>
    <span class="n">x15</span><span class="p">,</span> <span class="n">x25</span><span class="p">,</span> <span class="n">x35</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x14</span><span class="p">,</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x24</span><span class="p">,</span> <span class="n">x3</span> <span class="o">*</span> <span class="n">x34</span>
    <span class="n">x16</span><span class="p">,</span> <span class="n">x26</span><span class="p">,</span> <span class="n">x36</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x15</span><span class="p">,</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x25</span><span class="p">,</span> <span class="n">x3</span> <span class="o">*</span> <span class="n">x35</span>
    <span class="n">x17</span><span class="p">,</span> <span class="n">x27</span><span class="p">,</span> <span class="n">x37</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x16</span><span class="p">,</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x26</span><span class="p">,</span> <span class="n">x3</span> <span class="o">*</span> <span class="n">x36</span>
    <span class="n">x18</span><span class="p">,</span> <span class="n">x28</span><span class="p">,</span> <span class="n">x38</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x17</span><span class="p">,</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x27</span><span class="p">,</span> <span class="n">x3</span> <span class="o">*</span> <span class="n">x37</span>

    <span class="n">I2</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">6</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x22</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x2</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x22</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x12</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span>
        <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x22</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x32</span>
    <span class="p">)</span>
    <span class="n">I4</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x22</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x23</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x24</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x22</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x23</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x22</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x32</span>
    <span class="p">)</span>
    <span class="n">I6</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">8</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x24</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x25</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x26</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">+</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x23</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x24</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x25</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x26</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">48</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x22</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x23</span>
        <span class="o">+</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x24</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x25</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x26</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x16</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x26</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x36</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x22</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x23</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x24</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x25</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x15</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x25</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x35</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x22</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x23</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x24</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x3</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x14</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x24</span> <span class="o">*</span> <span class="n">x32</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x13</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x23</span> <span class="o">*</span> <span class="n">x33</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x12</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">x34</span>
        <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x22</span> <span class="o">*</span> <span class="n">x34</span>
    <span class="p">)</span>
    <span class="n">I10</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">x12</span>
        <span class="o">*</span> <span class="n">x22</span>
        <span class="o">*</span> <span class="n">x32</span>
        <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x3</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">I2</span><span class="p">,</span> <span class="n">I4</span><span class="p">,</span> <span class="n">I6</span><span class="p">,</span> <span class="n">I10</span></div>



<span class="c1"># computes the p-adic L-invariant</span>
<span class="c1"># A = &lt;gamma_1,gamma_1&gt;</span>
<span class="c1"># B = &lt;gamma_1,gamma_2&gt;</span>
<span class="c1"># D = &lt;gamma_2,gamma_2&gt;</span>
<span class="c1"># Tmatrix is the matrix of the T_ell operator with respect to the basis (gamma_1,gamma_2)</span>
<span class="c1"># the output is (a,b), where L_p = a + bT</span>
<div class="viewcode-block" id="p_adic_l_invariant">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.p_adic_l_invariant">[docs]</a>
<span class="k">def</span> <span class="nf">p_adic_l_invariant</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Tmatrix</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">p_adic_l_invariant_additive</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">B</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">A</span><span class="o">.</span><span class="n">ordp</span><span class="p">(),</span> <span class="n">B</span><span class="o">.</span><span class="n">ordp</span><span class="p">(),</span> <span class="n">Tmatrix</span><span class="p">)</span></div>



<div class="viewcode-block" id="p_adic_l_invariant_additive">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.p_adic_l_invariant_additive">[docs]</a>
<span class="k">def</span> <span class="nf">p_adic_l_invariant_additive</span><span class="p">(</span><span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">Tmatrix</span><span class="p">):</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">logA</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
    <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span> <span class="o">=</span> <span class="n">K</span><span class="p">(</span><span class="n">logA</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="n">logB</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Tmatrix</span><span class="o">.</span><span class="n">change_ring</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">alpha</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="n">beta</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">beta</span><span class="p">])</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">M</span><span class="o">.</span><span class="n">solve_right</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">list</span><span class="p">()</span></div>



<div class="viewcode-block" id="qlogs_from_Lp_and_ords">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.qlogs_from_Lp_and_ords">[docs]</a>
<span class="k">def</span> <span class="nf">qlogs_from_Lp_and_ords</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Tmatrix</span><span class="p">,</span> <span class="n">q1ord</span><span class="p">,</span> <span class="n">q2ord</span><span class="p">,</span> <span class="n">q3ord</span><span class="p">):</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
    <span class="n">ordA</span> <span class="o">=</span> <span class="n">q2ord</span> <span class="o">+</span> <span class="n">q3ord</span>
    <span class="n">ordB</span> <span class="o">=</span> <span class="o">-</span><span class="n">q3ord</span>
    <span class="n">ordD</span> <span class="o">=</span> <span class="n">q1ord</span> <span class="o">+</span> <span class="n">q3ord</span>
    <span class="n">bord</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">ordA</span><span class="p">,</span> <span class="n">ordB</span><span class="p">,</span> <span class="n">ordB</span><span class="p">,</span> <span class="n">ordD</span><span class="p">])</span> <span class="o">*</span> <span class="n">Tmatrix</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">ordA</span><span class="p">,</span> <span class="n">bord</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ordB</span><span class="p">,</span> <span class="n">bord</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ordD</span><span class="p">,</span> <span class="n">bord</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
    <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> <span class="n">logD</span> <span class="o">=</span> <span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]))</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">logB</span> <span class="o">+</span> <span class="n">logD</span><span class="p">,</span> <span class="n">logA</span> <span class="o">+</span> <span class="n">logB</span><span class="p">,</span> <span class="o">-</span><span class="n">logB</span></div>



<div class="viewcode-block" id="all_possible_qords">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.all_possible_qords">[docs]</a>
<span class="k">def</span> <span class="nf">all_possible_qords</span><span class="p">(</span><span class="n">Tmatrix</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Find linear equation from matrix</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">ZZ</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">Tmatrix</span><span class="o">.</span><span class="n">list</span><span class="p">())</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">-</span> <span class="n">z</span> <span class="o">-</span> <span class="n">t</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
    <span class="c1"># Note: since we assume that the minimal polynomial is irreducible,</span>
    <span class="c1"># we already know that z*y*r != 0</span>

    <span class="c1"># Know that q1^z = q2^y q3^r</span>
    <span class="k">for</span> <span class="n">ordq2</span><span class="p">,</span> <span class="n">ordq3</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ordq1</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">ordq2</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">ordq3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ordq1</span> <span class="o">%</span> <span class="n">z</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">ordq1</span> <span class="o">/=</span> <span class="n">z</span>
        <span class="n">ordtup</span> <span class="o">=</span> <span class="p">[</span><span class="n">ordq1</span><span class="p">,</span> <span class="n">ordq2</span><span class="p">,</span> <span class="n">ordq3</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">o</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ordtup</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">([</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ordtup</span> <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="nb">set</span><span class="p">([(</span><span class="n">ordq1</span><span class="p">,</span> <span class="n">ordq2</span><span class="p">,</span> <span class="n">ordq3</span><span class="p">)]))</span>
    <span class="c1"># Know that q2^y = q1^z q3^-r</span>
    <span class="k">for</span> <span class="n">ordq1</span><span class="p">,</span> <span class="n">ordq3</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ordq2</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">z</span> <span class="o">*</span> <span class="n">ordq1</span> <span class="o">-</span> <span class="n">r</span> <span class="o">*</span> <span class="n">ordq3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ordq2</span> <span class="o">%</span> <span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">ordq2</span> <span class="o">/=</span> <span class="n">y</span>
        <span class="n">ordtup</span> <span class="o">=</span> <span class="p">[</span><span class="n">ordq1</span><span class="p">,</span> <span class="n">ordq2</span><span class="p">,</span> <span class="n">ordq3</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">o</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ordtup</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">([</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ordtup</span> <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="nb">set</span><span class="p">([(</span><span class="n">ordq1</span><span class="p">,</span> <span class="n">ordq2</span><span class="p">,</span> <span class="n">ordq3</span><span class="p">)]))</span>
    <span class="c1"># Know that q3^r = q1^z q2^-y</span>
    <span class="k">for</span> <span class="n">ordq1</span><span class="p">,</span> <span class="n">ordq2</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ordq3</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">z</span> <span class="o">*</span> <span class="n">ordq1</span> <span class="o">-</span> <span class="n">y</span> <span class="o">*</span> <span class="n">ordq2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ordq3</span> <span class="o">%</span> <span class="n">r</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">ordq3</span> <span class="o">/=</span> <span class="n">r</span>
        <span class="n">ordtup</span> <span class="o">=</span> <span class="p">[</span><span class="n">ordq1</span><span class="p">,</span> <span class="n">ordq2</span><span class="p">,</span> <span class="n">ordq3</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">o</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ordtup</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">([</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">ordtup</span> <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="nb">set</span><span class="p">([(</span><span class="n">ordq1</span><span class="p">,</span> <span class="n">ordq2</span><span class="p">,</span> <span class="n">ordq3</span><span class="p">)]))</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ans</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">initial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">tmp</span><span class="p">[</span><span class="n">t0</span><span class="p">:]</span></div>



<div class="viewcode-block" id="recognize_invariant">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.recognize_invariant">[docs]</a>
<span class="k">def</span> <span class="nf">recognize_invariant</span><span class="p">(</span>
    <span class="n">j_invariant</span><span class="p">,</span>
    <span class="n">base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">prec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">twopowlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">return_all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="k">if</span> <span class="n">base</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">QQ</span>
    <span class="k">if</span> <span class="n">twopowlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">twopowlist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">deg</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
    <span class="n">Kp</span> <span class="o">=</span> <span class="n">j_invariant</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">*</span> <span class="n">RR</span><span class="p">(</span><span class="n">Kp</span><span class="o">.</span><span class="n">prime</span><span class="p">())</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">twopowlist</span><span class="p">:</span>
        <span class="n">twopow</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span>
        <span class="n">fx</span> <span class="o">=</span> <span class="n">our_algdep</span><span class="p">(</span><span class="n">j_invariant</span> <span class="o">/</span> <span class="n">twopow</span><span class="p">,</span> <span class="n">deg</span><span class="p">)</span>
        <span class="n">hfx</span> <span class="o">=</span> <span class="n">height_polynomial</span><span class="p">(</span><span class="n">fx</span><span class="p">)</span>
        <span class="n">trash_height</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">*</span> <span class="n">j_invariant</span><span class="o">.</span><span class="n">precision_relative</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hfx</span> <span class="o">&lt;</span> <span class="n">trash_height</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="p">[</span><span class="n">twopow</span> <span class="o">*</span> <span class="n">o</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">fx</span><span class="o">.</span><span class="n">change_ring</span><span class="p">(</span><span class="n">base</span><span class="p">)</span><span class="o">.</span><span class="n">roots</span><span class="p">()]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">return_all</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">ans</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">ans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="teichmuller_system">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.teichmuller_system">[docs]</a>
<span class="k">def</span> <span class="nf">teichmuller_system</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">teichmuller</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">lift_to_precision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision_cap</span><span class="p">()))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue_field</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="p">]</span></div>



<div class="viewcode-block" id="take_to_Qp">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.take_to_Qp">[docs]</a>
<span class="k">def</span> <span class="nf">take_to_Qp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;trace&quot;</span><span class="p">):</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">trace_absolute</span><span class="p">()</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">absolute_degree</span><span class="p">()</span>
    <span class="n">ordp</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">parent</span><span class="p">()(</span><span class="n">ans</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">ordp</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">tolerance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ordp</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">ordp</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input does not look p-adic&quot;</span><span class="p">)</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">add_bigoh</span><span class="p">(</span><span class="n">ordp</span><span class="o">.</span><span class="n">floor</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">ans</span></div>



<div class="viewcode-block" id="j1_inv_padic_from_xvec">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.j1_inv_padic_from_xvec">[docs]</a>
<span class="k">def</span> <span class="nf">j1_inv_padic_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">*</span> <span class="n">prec</span>
    <span class="n">j1</span> <span class="o">=</span> <span class="n">j1_inv_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">take_to_Qp</span><span class="p">(</span><span class="n">j1</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="j1_inv_padic_from_half_periods">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.j1_inv_padic_from_half_periods">[docs]</a>
<span class="k">def</span> <span class="nf">j1_inv_padic_from_half_periods</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">j1_inv_padic_from_xvec</span><span class="p">(</span>
        <span class="n">xvec_padic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="p">),</span> <span class="n">prec</span><span class="p">,</span> <span class="n">threshold</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="I2_inv_padic_from_xvec">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.I2_inv_padic_from_xvec">[docs]</a>
<span class="k">def</span> <span class="nf">I2_inv_padic_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">*</span> <span class="n">prec</span>
    <span class="n">I2</span> <span class="o">=</span> <span class="n">I2_inv</span><span class="p">(</span><span class="o">*</span><span class="n">xvec</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">take_to_Qp</span><span class="p">(</span><span class="n">I2</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="I2_inv_padic_from_half_periods">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.I2_inv_padic_from_half_periods">[docs]</a>
<span class="k">def</span> <span class="nf">I2_inv_padic_from_half_periods</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I2_inv_padic_from_xvec</span><span class="p">(</span>
        <span class="n">xvec_padic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="p">),</span> <span class="n">prec</span><span class="p">,</span> <span class="n">threshold</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="absolute_igusa_padic_from_xvec">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.absolute_igusa_padic_from_xvec">[docs]</a>
<span class="k">def</span> <span class="nf">absolute_igusa_padic_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">j3</span> <span class="o">=</span> <span class="n">igusa_clebsch_absolute_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">*</span> <span class="n">prec</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j1</span> <span class="o">=</span> <span class="n">take_to_Qp</span><span class="p">(</span><span class="n">j1</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
        <span class="n">j2</span> <span class="o">=</span> <span class="n">take_to_Qp</span><span class="p">(</span><span class="n">j2</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
        <span class="n">j3</span> <span class="o">=</span> <span class="n">take_to_Qp</span><span class="p">(</span><span class="n">j3</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">j3</span></div>



<div class="viewcode-block" id="absolute_igusa_padic_from_half_periods">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.absolute_igusa_padic_from_half_periods">[docs]</a>
<span class="k">def</span> <span class="nf">absolute_igusa_padic_from_half_periods</span><span class="p">(</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="n">xvec</span> <span class="o">=</span> <span class="n">xvec_padic</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">j3</span> <span class="o">=</span> <span class="n">igusa_clebsch_absolute_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">*</span> <span class="n">prec</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j1</span> <span class="o">=</span> <span class="n">take_to_Qp</span><span class="p">(</span><span class="n">j1</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
        <span class="n">j2</span> <span class="o">=</span> <span class="n">take_to_Qp</span><span class="p">(</span><span class="n">j2</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
        <span class="n">j3</span> <span class="o">=</span> <span class="n">take_to_Qp</span><span class="p">(</span><span class="n">j3</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">j3</span></div>



<div class="viewcode-block" id="multiplicative_scalar_product">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.multiplicative_scalar_product">[docs]</a>
<span class="k">def</span> <span class="nf">multiplicative_scalar_product</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">bi</span><span class="p">,</span> <span class="n">vi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="n">ans</span> <span class="o">*=</span> <span class="n">vi</span> <span class="o">**</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">bi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ans</span></div>



<div class="viewcode-block" id="left_multiply_multiplicative">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.left_multiply_multiplicative">[docs]</a>
<span class="k">def</span> <span class="nf">left_multiply_multiplicative</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">V</span><span class="p">):</span>  <span class="c1"># V^B</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">parent</span><span class="p">()(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ans</span><span class="o">.</span><span class="n">nrows</span><span class="p">()),</span> <span class="nb">range</span><span class="p">(</span><span class="n">ans</span><span class="o">.</span><span class="n">ncols</span><span class="p">())):</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiplicative_scalar_product</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">list</span><span class="p">(),</span> <span class="n">V</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">list</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">ans</span></div>



<div class="viewcode-block" id="right_multiply_multiplicative">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.right_multiply_multiplicative">[docs]</a>
<span class="k">def</span> <span class="nf">right_multiply_multiplicative</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">left_multiply_multiplicative</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">W</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span></div>



<div class="viewcode-block" id="generate_matlists">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.generate_matlists">[docs]</a>
<span class="k">def</span> <span class="nf">generate_matlists</span><span class="p">(</span><span class="n">Lambdalist</span><span class="p">,</span> <span class="n">mat_coeffs_range</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">mlistX</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mlistY</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">mat_coeffs_range</span><span class="p">,</span> <span class="n">mat_coeffs_range</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">determinant</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mlistY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">determinant</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
                <span class="n">mlistX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">mlistX</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mlistX</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">list</span><span class="p">()]))</span>
    <span class="n">mlistY</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mlistY</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">list</span><span class="p">()]))</span>
    <span class="n">mlistYYL</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">Y</span> <span class="ow">in</span> <span class="n">mlistY</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">Lambda</span> <span class="ow">in</span> <span class="n">Lambdalist</span><span class="p">:</span>
            <span class="n">YL</span> <span class="o">=</span> <span class="n">left_multiply_multiplicative</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Lambda</span><span class="p">)</span>
            <span class="n">mlistYYL</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Y</span><span class="p">,</span> <span class="n">YL</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">X</span><span class="p">,</span> <span class="n">YYL</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">mlistX</span><span class="p">,</span> <span class="n">mlistYYL</span><span class="p">):</span>
        <span class="n">Y</span><span class="p">,</span> <span class="n">YL</span> <span class="o">=</span> <span class="n">YYL</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">determinant</span><span class="p">()</span>
        <span class="n">YLXinv</span> <span class="o">=</span> <span class="n">right_multiply_multiplicative</span><span class="p">(</span><span class="n">YL</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">adjugate</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">YLXinv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">YLXinv</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="k">continue</span>
        <span class="k">yield</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">YLXinv</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span></div>

    <span class="c1"># return sorted(all_mats, key = lambda x: max([o.abs() for o in x[0].list() + x[1].list()]))</span>


<div class="viewcode-block" id="build_Lambdalist_from_AB">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.build_Lambdalist_from_AB">[docs]</a>
<span class="k">def</span> <span class="nf">build_Lambdalist_from_AB</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">scaling</span><span class="p">):</span>
    <span class="c1"># T is the matrix of Hecke acting on Homology</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">T</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">/</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">.</span><span class="n">lcm</span><span class="p">(</span><span class="n">beta</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
    <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">),</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">beta</span><span class="p">)</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">A0</span><span class="p">,</span> <span class="n">B0</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span>
        <span class="n">our_nroot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">scaling</span><span class="p">,</span> <span class="n">return_all</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">our_nroot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">scaling</span><span class="p">,</span> <span class="n">return_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">B1</span> <span class="ow">in</span> <span class="n">our_nroot</span><span class="p">(</span><span class="n">B0</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">return_all</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">A0</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">B1</span><span class="o">**</span><span class="n">alpha</span><span class="p">,</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">B1</span><span class="o">**</span><span class="n">beta</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">ans</span></div>



<div class="viewcode-block" id="find_igusa_invariants_from_AB">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.find_igusa_invariants_from_AB">[docs]</a>
<span class="k">def</span> <span class="nf">find_igusa_invariants_from_AB</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">scaling</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">success_list</span>
    <span class="n">Lambdalist</span> <span class="o">=</span> <span class="n">build_Lambdalist_from_AB</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">scaling</span><span class="p">)</span>
    <span class="n">K0</span> <span class="o">=</span> <span class="n">Lambdalist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">base_ring</span><span class="p">()</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">K0</span><span class="o">.</span><span class="n">prime</span><span class="p">()</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;phi&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Qp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">prec</span><span class="p">)(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">mat_coeffs_range</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mat_coeffs_range&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="n">QQ</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s2">&quot;list_I10&quot;</span><span class="p">):</span>
        <span class="n">list_I10</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;list_I10&quot;</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;list_I10_padic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">phi</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">list_I10</span><span class="p">]</span>
    <span class="c1"># matlists = kwargs.get(&#39;matlists&#39;,generate_matlists(Lambdalist,mat_coeffs_range))</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outfile&quot;</span><span class="p">)</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">QuadExt</span><span class="p">(</span><span class="n">K0</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">total_tests</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>  <span class="c1"># len(matlists)</span>
    <span class="n">fwrite</span><span class="p">(</span>
        <span class="s2">&quot;# Starting search for Igusa invariants. Number of tests = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total_tests</span><span class="p">),</span>
        <span class="n">outfile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ntests</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">success_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">YLXinv</span><span class="p">,</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">generate_matlists</span><span class="p">(</span><span class="n">Lambdalist</span><span class="p">,</span> <span class="n">mat_coeffs_range</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;X = </span><span class="si">%s</span><span class="s2">, Y = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">list</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">list</span><span class="p">())</span>
        <span class="n">ntests</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">ntests</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fwrite</span><span class="p">(</span>
                <span class="s2">&quot;# num_tests = </span><span class="si">%s</span><span class="s2"> / </span><span class="si">%s</span><span class="s2"> (successes = </span><span class="si">%s</span><span class="s2">)&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">ntests</span><span class="p">,</span> <span class="n">total_tests</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">success_list</span><span class="p">)),</span>
                <span class="n">outfile</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">Ag</span><span class="p">,</span> <span class="n">Bg</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">Dg</span> <span class="o">=</span> <span class="n">YLXinv</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
        <span class="n">q1inv</span> <span class="o">=</span> <span class="p">(</span><span class="n">Bg</span> <span class="o">*</span> <span class="n">Dg</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">q2inv</span> <span class="o">=</span> <span class="p">(</span><span class="n">Bg</span> <span class="o">*</span> <span class="n">Ag</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">q3inv</span> <span class="o">=</span> <span class="n">Bg</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">K</span><span class="p">(</span><span class="n">q1inv</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(),</span> <span class="n">K</span><span class="p">(</span><span class="n">q2inv</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(),</span> <span class="n">K</span><span class="p">(</span><span class="n">q3inv</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span>
            <span class="n">xvec</span> <span class="o">=</span> <span class="n">xvec_padic</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">q1inv</span><span class="p">,</span> <span class="n">q2inv</span><span class="p">,</span> <span class="n">q3inv</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">PrecisionError</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">out_str</span> <span class="o">=</span> <span class="n">check_generic</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">success_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_str</span><span class="p">)</span>
            <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Success! data = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">out_str</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">success_list</span></div>



<div class="viewcode-block" id="find_igusa_invariants">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.find_igusa_invariants">[docs]</a>
<span class="k">def</span> <span class="nf">find_igusa_invariants</span><span class="p">(</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">b</span><span class="p">,</span>
    <span class="n">T</span><span class="p">,</span>
    <span class="n">embedding</span><span class="p">,</span>
    <span class="n">prec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">list_I10</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">Pgen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">N</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">cheatjs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">parallelize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Trying to recognize invariants...&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
    <span class="n">Pring</span> <span class="o">=</span> <span class="n">embedding</span><span class="o">.</span><span class="n">domain</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">prec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">precision_cap</span><span class="p">()</span>
    <span class="n">Tlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fT</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">charpoly</span><span class="p">()</span>
    <span class="n">fT_trace</span> <span class="o">=</span> <span class="o">-</span><span class="n">fT</span><span class="o">.</span><span class="n">list</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">fT_trace</span> <span class="o">-</span> <span class="n">x0</span>
        <span class="k">if</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span> <span class="o">==</span> <span class="n">fT</span><span class="o">.</span><span class="n">list</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span>
            <span class="k">assert</span> <span class="n">fT</span> <span class="o">==</span> <span class="n">M</span><span class="o">.</span><span class="n">charpoly</span><span class="p">()</span>
            <span class="n">Tlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    <span class="n">Tlist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">Tlist</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">(),</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">(),</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">(),</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()),</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Tlist</span><span class="p">):</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Doing matrix </span><span class="si">%s</span><span class="s2"> / </span><span class="si">%s</span><span class="s2"> ( = </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Tlist</span><span class="p">),</span> <span class="n">tt</span><span class="o">.</span><span class="n">list</span><span class="p">()),</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="n">Lp</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">tt</span>
        <span class="n">inp_vec</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">Lp</span><span class="p">,</span> <span class="n">ordmat</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">Pring</span><span class="p">,</span> <span class="n">cheatjs</span><span class="p">,</span> <span class="n">embedding</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">list_I10</span><span class="p">,</span> <span class="n">Pgen</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ordmat</span> <span class="ow">in</span> <span class="n">all_possible_ordmats</span><span class="p">(</span><span class="n">Lp</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">num_inpts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp_vec</span><span class="p">)</span>
        <span class="n">jj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">parallelize</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">inpt</span><span class="p">,</span> <span class="n">outt</span> <span class="ow">in</span> <span class="n">parallel</span><span class="p">(</span><span class="n">find_igusa_invariants_from_L_inv</span><span class="p">)(</span><span class="n">inp_vec</span><span class="p">):</span>
                <span class="n">jj</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">outt</span> <span class="o">!=</span> <span class="s2">&quot;Nope&quot;</span>
                    <span class="ow">and</span> <span class="n">outt</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
                    <span class="ow">and</span> <span class="s2">&quot;indistinguishable&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outt</span>
                    <span class="ow">and</span> <span class="s2">&quot;Error&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outt</span>
                <span class="p">):</span>
                    <span class="n">fwrite</span><span class="p">(</span>
                        <span class="s2">&quot;# (</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">) </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span>
                            <span class="n">jj</span><span class="p">,</span>
                            <span class="n">num_inpts</span><span class="p">,</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">list</span><span class="p">()),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">inpt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">list</span><span class="p">()),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">inpt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">list</span><span class="p">()),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">outt</span><span class="p">),</span>
                        <span class="p">),</span>
                        <span class="n">outfile</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">outt</span> <span class="o">!=</span> <span class="s2">&quot;Nope&quot;</span><span class="p">:</span>
                    <span class="n">fwrite</span><span class="p">(</span>
                        <span class="s2">&quot;# (</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">) (</span><span class="si">%s</span><span class="s2">)...Out: </span><span class="si">%s</span><span class="s2">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="n">num_inpts</span><span class="p">,</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">list</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">outt</span><span class="p">)),</span>
                        <span class="n">outfile</span><span class="p">,</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">inpt</span> <span class="ow">in</span> <span class="n">inp_vec</span><span class="p">:</span>
                <span class="n">outt</span> <span class="o">=</span> <span class="n">find_igusa_invariants_from_L_inv</span><span class="p">(</span><span class="o">*</span><span class="n">inpt</span><span class="p">)</span>
                <span class="n">jj</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">outt</span> <span class="o">!=</span> <span class="s2">&quot;Nope&quot;</span>
                    <span class="ow">and</span> <span class="n">outt</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
                    <span class="ow">and</span> <span class="s2">&quot;indistinguishable&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outt</span>
                    <span class="ow">and</span> <span class="s2">&quot;Error&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outt</span>
                <span class="p">):</span>
                    <span class="n">fwrite</span><span class="p">(</span>
                        <span class="s2">&quot;# (</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">) </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span>
                            <span class="n">jj</span><span class="p">,</span>
                            <span class="n">num_inpts</span><span class="p">,</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">list</span><span class="p">()),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">inpt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">list</span><span class="p">()),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">inpt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">list</span><span class="p">()),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">outt</span><span class="p">),</span>
                        <span class="p">),</span>
                        <span class="n">outfile</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">outt</span> <span class="o">!=</span> <span class="s2">&quot;Nope&quot;</span><span class="p">:</span>
                    <span class="n">fwrite</span><span class="p">(</span>
                        <span class="s2">&quot;# (</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">) (</span><span class="si">%s</span><span class="s2">)...Out: </span><span class="si">%s</span><span class="s2">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">jj</span><span class="p">,</span> <span class="n">num_inpts</span><span class="p">,</span> <span class="n">inpt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">list</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">outt</span><span class="p">)),</span>
                        <span class="n">outfile</span><span class="p">,</span>
                    <span class="p">)</span></div>



<div class="viewcode-block" id="check_generic">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.check_generic">[docs]</a>
<span class="k">def</span> <span class="nf">check_generic</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s2">&quot;cheatjs&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">check_cheatjs</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s2">&quot;list_I10&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">check_absoluteinvs</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span> <span class="n">check_listI10</span><span class="p">(</span>
            <span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">check_absoluteinvs</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="check_cheatjs">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.check_cheatjs">[docs]</a>
<span class="k">def</span> <span class="nf">check_cheatjs</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">cheatjs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cheatjs&quot;</span><span class="p">)</span>
    <span class="n">minval</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;minval&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j1</span> <span class="o">=</span> <span class="n">j1_inv_padic_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">PrecisionError</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">j1</span> <span class="o">-</span> <span class="n">cheatjs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">minval</span><span class="p">:</span>
        <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">j3</span> <span class="o">=</span> <span class="n">absolute_igusa_padic_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">-</span> <span class="n">u</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">j3</span><span class="p">],</span> <span class="n">cheatjs</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">o</span> <span class="o">&gt;</span> <span class="n">minval</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]):</span>
            <span class="n">out_str</span> <span class="o">=</span> <span class="s2">&quot;# Success !! -&gt; </span><span class="si">%s</span><span class="s2">, valuation=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">vals</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">out_str</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span></div>



<div class="viewcode-block" id="check_absoluteinvs">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.check_absoluteinvs">[docs]</a>
<span class="k">def</span> <span class="nf">check_absoluteinvs</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;base&quot;</span><span class="p">)</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">)</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outfile&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j1</span> <span class="o">=</span> <span class="n">j1_inv_padic_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">PrecisionError</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j1n</span> <span class="o">=</span> <span class="n">recognize_invariant</span><span class="p">(</span>
            <span class="n">j1</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span>
        <span class="p">)</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Possible j1 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j1n</span><span class="p">),</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">j3</span> <span class="o">=</span> <span class="n">absolute_igusa_padic_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">j2n</span> <span class="o">=</span> <span class="n">recognize_invariant</span><span class="p">(</span>
            <span class="n">j2</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span>
        <span class="p">)</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Possible j2 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j2n</span><span class="p">),</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="n">j3n</span> <span class="o">=</span> <span class="n">recognize_invariant</span><span class="p">(</span>
            <span class="n">j3</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span>
        <span class="p">)</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Possible j3 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j3n</span><span class="p">),</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="n">out_str</span> <span class="o">=</span> <span class="s2">&quot;# Candidate js = </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">) jpadic = (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">j1n</span><span class="p">,</span>
            <span class="n">j2n</span><span class="p">,</span>
            <span class="n">j3n</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">j1</span><span class="p">,</span>
            <span class="n">j2</span><span class="p">,</span>
            <span class="n">j3</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">out_str</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span></div>



<div class="viewcode-block" id="check_listI10">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.check_listI10">[docs]</a>
<span class="k">def</span> <span class="nf">check_listI10</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">list_I10</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;list_I10&quot;</span><span class="p">)</span>
    <span class="n">list_I10_padic</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;list_I10_padic&quot;</span><span class="p">)</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;base&quot;</span><span class="p">)</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">)</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outfile&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">j1</span> <span class="o">=</span> <span class="n">j1_inv_padic_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">PrecisionError</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">I10new</span><span class="p">,</span> <span class="n">I10p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list_I10</span><span class="p">,</span> <span class="n">list_I10_padic</span><span class="p">):</span>
        <span class="n">I2c_list</span> <span class="o">=</span> <span class="n">our_nroot</span><span class="p">(</span><span class="n">j1</span> <span class="o">*</span> <span class="n">I10p</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">return_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">I2c</span> <span class="ow">in</span> <span class="n">I2c_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">I2new</span> <span class="o">=</span> <span class="n">recognize_invariant</span><span class="p">(</span>
                    <span class="n">I2c</span><span class="p">,</span>
                    <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span>
                    <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                    <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">,</span>
                    <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span>
                    <span class="n">twopowlist</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Possible I2 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">I2new</span><span class="p">),</span> <span class="n">outfile</span><span class="p">)</span>
                <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">j3</span> <span class="o">=</span> <span class="n">absolute_igusa_padic_from_xvec</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
                <span class="n">I4new</span> <span class="o">=</span> <span class="n">recognize_invariant</span><span class="p">(</span>
                    <span class="n">j2</span> <span class="o">*</span> <span class="n">I10p</span> <span class="o">/</span> <span class="n">I2c</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span>
                    <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                    <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">,</span>
                    <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span>
                    <span class="n">twopowlist</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Possible I4 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">I4new</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
                <span class="n">I6new</span> <span class="o">=</span> <span class="n">recognize_invariant</span><span class="p">(</span>
                    <span class="n">j3</span> <span class="o">*</span> <span class="n">I10p</span> <span class="o">/</span> <span class="n">I2c</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span>
                    <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                    <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">,</span>
                    <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span>
                    <span class="n">twopowlist</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Possible I6 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">I6new</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
                <span class="n">out_str</span> <span class="o">=</span> <span class="s2">&quot;# Candidate = </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">I2new</span><span class="p">,</span>
                    <span class="n">I4new</span><span class="p">,</span>
                    <span class="n">I6new</span><span class="p">,</span>
                    <span class="n">I10new</span><span class="p">,</span>
                    <span class="n">data</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">out_str</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span></div>



<div class="viewcode-block" id="frobenius_polynomial">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.frobenius_polynomial">[docs]</a>
<span class="k">def</span> <span class="nf">frobenius_polynomial</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">base_ring</span><span class="p">())</span>
    <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">count_points</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ap1</span> <span class="o">=</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">N1</span>
    <span class="n">ap2</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">N2</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">ap1</span> <span class="o">*</span> <span class="n">ap1</span> <span class="o">-</span> <span class="n">ap2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trace = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ap1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;norm = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">q</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">QQ</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]([</span><span class="n">q</span> <span class="o">*</span> <span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="n">ap1</span> <span class="o">*</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="o">-</span><span class="n">ap1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span></div>



<div class="viewcode-block" id="euler_factor_twodim">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.euler_factor_twodim">[docs]</a>
<span class="k">def</span> <span class="nf">euler_factor_twodim</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">euler_factor_twodim_tn</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">T</span><span class="o">.</span><span class="n">trace</span><span class="p">(),</span> <span class="n">T</span><span class="o">.</span><span class="n">determinant</span><span class="p">())</span></div>



<div class="viewcode-block" id="euler_factor_twodim_tn">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.euler_factor_twodim_tn">[docs]</a>
<span class="k">def</span> <span class="nf">euler_factor_twodim_tn</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">QQ</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]([</span><span class="n">q</span> <span class="o">*</span> <span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="n">q</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span></div>



<div class="viewcode-block" id="get_pseudo_orthonormal_homology">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.get_pseudo_orthonormal_homology">[docs]</a>
<span class="k">def</span> <span class="nf">get_pseudo_orthonormal_homology</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">cocycles</span><span class="p">,</span> <span class="n">hecke_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">hecke_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hecke_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ker</span> <span class="o">=</span> <span class="n">get_homology_kernel</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">hecke_data</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">hecke_data</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ker</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span> <span class="o">=</span> <span class="n">cocycles</span>
    <span class="n">a00</span> <span class="o">=</span> <span class="n">f0</span><span class="o">.</span><span class="n">pair_with_cycle</span><span class="p">(</span><span class="n">ker</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">a01</span> <span class="o">=</span> <span class="n">f0</span><span class="o">.</span><span class="n">pair_with_cycle</span><span class="p">(</span><span class="n">ker</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">a10</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">pair_with_cycle</span><span class="p">(</span><span class="n">ker</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">a11</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">pair_with_cycle</span><span class="p">(</span><span class="n">ker</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">a00</span><span class="p">,</span> <span class="n">a01</span><span class="p">,</span> <span class="n">a10</span><span class="p">,</span> <span class="n">a11</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">a00</span><span class="p">),</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">a01</span><span class="p">),</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">a10</span><span class="p">),</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">a11</span><span class="p">)</span>
    <span class="n">determinant</span> <span class="o">=</span> <span class="n">a00</span> <span class="o">*</span> <span class="n">a11</span> <span class="o">-</span> <span class="n">a01</span> <span class="o">*</span> <span class="n">a10</span>
    <span class="n">fwrite</span><span class="p">(</span>
        <span class="s2">&quot;scaling = </span><span class="si">%s</span><span class="s2">; mat = Matrix(ZZ,2,2,[</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">])&quot;</span>
        <span class="o">%</span> <span class="p">(</span><span class="n">determinant</span><span class="p">,</span> <span class="n">a00</span><span class="p">,</span> <span class="n">a01</span><span class="p">,</span> <span class="n">a10</span><span class="p">,</span> <span class="n">a11</span><span class="p">),</span>
        <span class="n">outfile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">theta1</span> <span class="o">=</span> <span class="n">a11</span> <span class="o">*</span> <span class="n">ker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a10</span> <span class="o">*</span> <span class="n">ker</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">theta2</span> <span class="o">=</span> <span class="o">-</span><span class="n">a01</span> <span class="o">*</span> <span class="n">ker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a00</span> <span class="o">*</span> <span class="n">ker</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">determinant</span></div>



<div class="viewcode-block" id="guess_equation">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.guess_equation">[docs]</a>
<span class="k">def</span> <span class="nf">guess_equation</span><span class="p">(</span>
    <span class="n">code</span><span class="p">,</span>
    <span class="n">pol</span><span class="p">,</span>
    <span class="n">Pgen</span><span class="p">,</span>
    <span class="n">Dgen</span><span class="p">,</span>
    <span class="n">Npgen</span><span class="p">,</span>
    <span class="n">Sinf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">sign_ap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">prec</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">hecke_data_init</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">working_prec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">recognize_invariants</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">return_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">compute_G</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">compute_cohomology</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">abtuple</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;config.ini&quot;</span><span class="p">)</span>
    <span class="n">param_dict</span> <span class="o">=</span> <span class="n">config_section_map</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;General&quot;</span><span class="p">)</span>
    <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">config_section_map</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;GuessEquation&quot;</span><span class="p">))</span>
    <span class="n">param_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">param</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="o">**</span><span class="n">param_dict</span><span class="p">)</span>

    <span class="c1"># Get general parameters</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">outfile</span>
    <span class="n">use_ps_dists</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">use_ps_dists</span>
    <span class="n">use_shapiro</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">use_shapiro</span>
    <span class="n">use_sage_db</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">use_sage_db</span>
    <span class="n">magma_seed</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">magma_seed</span>
    <span class="n">use_magma</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">use_magma</span>
    <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">progress_bar</span>
    <span class="n">sign_at_infinity</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">sign_at_infinity</span>

    <span class="c1"># Get find_curve specific parameters</span>
    <span class="n">grouptype</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">grouptype</span>
    <span class="n">hecke_bound</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">hecke_bound</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">timeout</span>

    <span class="k">global</span> <span class="n">G</span><span class="p">,</span> <span class="n">Coh</span><span class="p">,</span> <span class="n">flist</span><span class="p">,</span> <span class="n">hecke_data</span><span class="p">,</span> <span class="n">g0</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">Alog</span><span class="p">,</span> <span class="n">Aval</span><span class="p">,</span> <span class="n">Amul</span><span class="p">,</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">Bval</span><span class="p">,</span> <span class="n">Bmul</span><span class="p">,</span> <span class="n">Dlog</span><span class="p">,</span> <span class="n">Dval</span><span class="p">,</span> <span class="n">Dmul</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">xi10</span><span class="p">,</span> <span class="n">xi20</span><span class="p">,</span> <span class="n">xi11</span><span class="p">,</span> <span class="n">xi21</span><span class="p">,</span> <span class="n">Phif</span>
    <span class="k">if</span> <span class="n">pol</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pol</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">QQ</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">Pgen</span>
        <span class="n">Pnrm</span> <span class="o">=</span> <span class="n">Pgen</span>
        <span class="n">Pring</span> <span class="o">=</span> <span class="n">QQ</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">Dgen</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="n">Npgen</span>
        <span class="n">Sinv_places</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">abtuple</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">abtuple</span> <span class="o">=</span> <span class="n">QuaternionAlgebra</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">.</span><span class="n">invariants</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">abtuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">QQ</span><span class="p">(</span><span class="n">abtuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">QQ</span><span class="p">(</span><span class="n">abtuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s2">&quot;periods_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">.sage&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="n">D</span> <span class="o">*</span> <span class="n">Np</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">NumberField</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">gen</span><span class="p">()</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">ideal</span><span class="p">(</span><span class="n">Pgen</span><span class="p">)</span>
        <span class="n">Pnrm</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
        <span class="n">Pring</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">ring</span><span class="p">()</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">ideal</span><span class="p">(</span><span class="n">Dgen</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">ideal</span><span class="p">(</span><span class="n">Npgen</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Sinf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Sinf</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">F</span><span class="o">.</span><span class="n">real_places</span><span class="p">()]</span>
        <span class="n">Sinf_places</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">real_places</span><span class="p">(</span><span class="n">prec</span><span class="o">=</span><span class="n">Infinity</span><span class="p">),</span> <span class="n">Sinf</span><span class="p">)</span> <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">abtuple</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">abtuple</span> <span class="o">=</span> <span class="n">quaternion_algebra_invariants_from_ramification</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">Sinf_places</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">abtuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="n">abtuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">F</span><span class="p">(</span><span class="n">abtuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="s2">&quot;periods_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">.sage&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">code</span><span class="p">,</span>
                <span class="n">F</span><span class="o">.</span><span class="n">discriminant</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">(),</span>
                <span class="n">Pnrm</span><span class="p">,</span>
                <span class="n">D</span><span class="o">.</span><span class="n">norm</span><span class="p">(),</span>
                <span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="n">D</span> <span class="o">*</span> <span class="n">Np</span><span class="p">)</span><span class="o">.</span><span class="n">norm</span><span class="p">(),</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">outfile</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Skipping because outfile exists&quot;</span>

    <span class="k">if</span> <span class="n">Pnrm</span> <span class="o">&gt;</span> <span class="mi">31</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Giving up, prime norm is too large (Pnrm = </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">Pnrm</span>
    <span class="n">fwrite</span><span class="p">(</span>
        <span class="s2">&quot;# Starting computation for candidate </span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="nb">str</span><span class="p">((</span><span class="n">code</span><span class="p">,</span> <span class="n">pol</span><span class="p">,</span> <span class="n">Pgen</span><span class="p">,</span> <span class="n">Dgen</span><span class="p">,</span> <span class="n">Npgen</span><span class="p">,</span> <span class="n">Sinf</span><span class="p">)),</span>
        <span class="n">outfile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;p = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Pnrm</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">compute_G</span><span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">BigArithGroup</span><span class="p">(</span>
            <span class="n">P</span><span class="p">,</span>
            <span class="n">abtuple</span><span class="p">,</span>
            <span class="n">Np</span><span class="p">,</span>
            <span class="n">base</span><span class="o">=</span><span class="n">F</span><span class="p">,</span>
            <span class="n">use_shapiro</span><span class="o">=</span><span class="n">use_shapiro</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="n">magma_seed</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span>
            <span class="n">use_sage_db</span><span class="o">=</span><span class="n">use_sage_db</span><span class="p">,</span>
            <span class="n">magma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">grouptype</span><span class="o">=</span><span class="n">grouptype</span><span class="p">,</span>
            <span class="n">logfile</span><span class="o">=</span><span class="n">logfile</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">compute_cohomology</span><span class="p">:</span>
        <span class="n">Coh</span> <span class="o">=</span> <span class="n">ArithCoh</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Computed Cohomology group&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# dim H^1 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Coh</span><span class="o">.</span><span class="n">dimension</span><span class="p">(),</span> <span class="n">outfile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hecke_data_init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">return_all</span><span class="p">:</span>
        <span class="n">fwrite</span><span class="p">(</span>
            <span class="s2">&quot;# Warning: setting return_all to False because user passed hecke_data_init value&quot;</span><span class="p">,</span>
            <span class="n">outfile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">return_all</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">return_all</span><span class="p">:</span>
        <span class="n">all_twodim_cocycles</span> <span class="o">=</span> <span class="n">get_twodim_cocycle</span><span class="p">(</span>
            <span class="n">Coh</span><span class="p">,</span>
            <span class="n">sign_at_infinity</span><span class="p">,</span>
            <span class="n">hecke_data</span><span class="o">=</span><span class="n">hecke_data_init</span><span class="p">,</span>
            <span class="n">bound</span><span class="o">=</span><span class="n">hecke_bound</span><span class="p">,</span>
            <span class="n">return_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">all_twodim_cocycles</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">get_twodim_cocycle</span><span class="p">(</span>
                    <span class="n">Coh</span><span class="p">,</span>
                    <span class="n">sign_at_infinity</span><span class="p">,</span>
                    <span class="n">hecke_data</span><span class="o">=</span><span class="n">hecke_data_init</span><span class="p">,</span>
                    <span class="n">bound</span><span class="o">=</span><span class="n">hecke_bound</span><span class="p">,</span>
                    <span class="n">return_all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">all_twodim_cocycles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_twodim_cocycles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Group not attached to surface&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# DONE WITH COMPUTATION&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;DONE&quot;</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Obtained cocycles&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">flist</span><span class="p">,</span> <span class="n">hecke_data</span> <span class="ow">in</span> <span class="n">all_twodim_cocycles</span><span class="p">:</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;Hecke data: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">hecke_data</span><span class="p">),</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="n">g0</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">scaling</span> <span class="o">=</span> <span class="n">get_pseudo_orthonormal_homology</span><span class="p">(</span>
            <span class="n">G</span><span class="p">,</span> <span class="n">flist</span><span class="p">,</span> <span class="n">hecke_data</span><span class="o">=</span><span class="n">hecke_data</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="n">outfile</span>
        <span class="p">)</span>
        <span class="n">g0_shapiro</span><span class="p">,</span> <span class="n">g1_shapiro</span> <span class="o">=</span> <span class="n">inverse_shapiro</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">g0</span><span class="p">),</span> <span class="n">inverse_shapiro</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">g1</span><span class="p">)</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Obtained homology generators&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">working_prec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">working_prec</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="mi">2</span> <span class="o">*</span> <span class="n">prec</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">])</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">xi10</span><span class="p">,</span> <span class="n">xi20</span> <span class="o">=</span> <span class="n">lattice_homology_cycle</span><span class="p">(</span>
                    <span class="n">P</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">Gn</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">wp</span><span class="p">(),</span> <span class="n">g0_shapiro</span><span class="p">,</span> <span class="n">working_prec</span>
                <span class="p">)</span>
                <span class="n">xi11</span><span class="p">,</span> <span class="n">xi21</span> <span class="o">=</span> <span class="n">lattice_homology_cycle</span><span class="p">(</span>
                    <span class="n">P</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">Gn</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">wp</span><span class="p">(),</span> <span class="n">g1_shapiro</span><span class="p">,</span> <span class="n">working_prec</span>
                <span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="n">PrecisionError</span><span class="p">:</span>
                <span class="n">working_prec</span> <span class="o">*=</span> <span class="mi">2</span>
                <span class="n">fwrite</span><span class="p">(</span>
                    <span class="s2">&quot;# Raising working precision to </span><span class="si">%s</span><span class="s2"> and trying again&quot;</span> <span class="o">%</span> <span class="n">working_prec</span><span class="p">,</span>
                    <span class="n">outfile</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Defined homology cycles&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="n">Phif</span> <span class="o">=</span> <span class="n">get_overconvergent_class_quaternionic</span><span class="p">(</span>
            <span class="n">P</span><span class="p">,</span>
            <span class="n">flist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">G</span><span class="p">,</span>
            <span class="n">prec</span><span class="p">,</span>
            <span class="n">sign_at_infinity</span><span class="p">,</span>
            <span class="n">sign_ap</span><span class="p">,</span>
            <span class="n">use_ps_dists</span><span class="o">=</span><span class="n">use_ps_dists</span><span class="p">,</span>
            <span class="n">use_sage_db</span><span class="o">=</span><span class="n">use_sage_db</span><span class="p">,</span>
            <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Overconvergent lift completed&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">integrals</span> <span class="kn">import</span> <span class="n">integrate_H1</span>

        <span class="n">numadd</span><span class="p">,</span> <span class="n">numval</span><span class="p">,</span> <span class="n">numroot</span> <span class="o">=</span> <span class="n">integrate_H1</span><span class="p">(</span>
            <span class="n">G</span><span class="p">,</span>
            <span class="n">xi10</span><span class="p">,</span>
            <span class="n">Phif</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">prec</span><span class="o">=</span><span class="n">working_prec</span><span class="p">,</span>
            <span class="n">twist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">,</span>
            <span class="n">multiplicative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">return_valuation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">denadd</span><span class="p">,</span> <span class="n">denval</span><span class="p">,</span> <span class="n">denroot</span> <span class="o">=</span> <span class="n">integrate_H1</span><span class="p">(</span>
            <span class="n">G</span><span class="p">,</span>
            <span class="n">xi20</span><span class="p">,</span>
            <span class="n">Phif</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">prec</span><span class="o">=</span><span class="n">working_prec</span><span class="p">,</span>
            <span class="n">twist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">,</span>
            <span class="n">multiplicative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">return_valuation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">Alog</span> <span class="o">=</span> <span class="n">take_to_Qp</span><span class="p">(</span><span class="n">numadd</span> <span class="o">-</span> <span class="n">denadd</span><span class="p">)</span>
        <span class="n">Aval</span> <span class="o">=</span> <span class="n">numval</span> <span class="o">-</span> <span class="n">denval</span>
        <span class="n">Amul</span> <span class="o">=</span> <span class="n">numroot</span> <span class="o">/</span> <span class="n">denroot</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Finished computation of A period&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="c1"># A = A.add_bigoh(prec + A.valuation())</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;A0 = p**(</span><span class="si">%s</span><span class="s2">) * (</span><span class="si">%s</span><span class="s2">) * (</span><span class="si">%s</span><span class="s2">).exp()&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Aval</span><span class="p">,</span> <span class="n">Amul</span><span class="p">,</span> <span class="n">Alog</span><span class="p">),</span> <span class="n">outfile</span><span class="p">)</span>

        <span class="n">numadd</span><span class="p">,</span> <span class="n">numval</span><span class="p">,</span> <span class="n">numroot</span> <span class="o">=</span> <span class="n">integrate_H1</span><span class="p">(</span>
            <span class="n">G</span><span class="p">,</span>
            <span class="n">xi11</span><span class="p">,</span>
            <span class="n">Phif</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">prec</span><span class="o">=</span><span class="n">working_prec</span><span class="p">,</span>
            <span class="n">twist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">,</span>
            <span class="n">multiplicative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">return_valuation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">denadd</span><span class="p">,</span> <span class="n">denval</span><span class="p">,</span> <span class="n">denroot</span> <span class="o">=</span> <span class="n">integrate_H1</span><span class="p">(</span>
            <span class="n">G</span><span class="p">,</span>
            <span class="n">xi21</span><span class="p">,</span>
            <span class="n">Phif</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">prec</span><span class="o">=</span><span class="n">working_prec</span><span class="p">,</span>
            <span class="n">twist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">progress_bar</span><span class="o">=</span><span class="n">progress_bar</span><span class="p">,</span>
            <span class="n">multiplicative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">return_valuation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">Blog</span> <span class="o">=</span> <span class="n">take_to_Qp</span><span class="p">(</span><span class="n">numadd</span> <span class="o">-</span> <span class="n">denadd</span><span class="p">)</span>
        <span class="n">Bval</span> <span class="o">=</span> <span class="n">numval</span> <span class="o">-</span> <span class="n">denval</span>
        <span class="n">Bmul</span> <span class="o">=</span> <span class="n">numroot</span> <span class="o">/</span> <span class="n">denroot</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Finished computation of B period&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="c1"># B = B.add_bigoh(prec + B.valuation())</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;B0 = p**(</span><span class="si">%s</span><span class="s2">) * (</span><span class="si">%s</span><span class="s2">) * (</span><span class="si">%s</span><span class="s2">).exp()&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Bval</span><span class="p">,</span> <span class="n">Bmul</span><span class="p">,</span> <span class="n">Blog</span><span class="p">),</span> <span class="n">outfile</span><span class="p">)</span>

        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">ell</span><span class="p">,</span> <span class="n">T0</span> <span class="ow">in</span> <span class="n">hecke_data</span><span class="p">:</span>
            <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;ell = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ell</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
            <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;T_ell = Matrix(ZZ,2,2,</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">T0</span><span class="o">.</span><span class="n">list</span><span class="p">()),</span> <span class="n">outfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">T0</span><span class="o">.</span><span class="n">charpoly</span><span class="p">()</span><span class="o">.</span><span class="n">is_irreducible</span><span class="p">():</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">T</span> <span class="o">=</span> <span class="n">T0</span>
                <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# The above is the good T&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# Good T not found...&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;DONE WITH ERROR&quot;</span>

        <span class="n">Dlog</span> <span class="o">=</span> <span class="n">Alog</span> <span class="o">+</span> <span class="n">T</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span> <span class="o">*</span> <span class="n">Blog</span>
        <span class="n">Dval</span> <span class="o">=</span> <span class="n">Aval</span> <span class="o">+</span> <span class="n">T</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span> <span class="o">*</span> <span class="n">Bval</span>
        <span class="n">Dmul</span> <span class="o">=</span> <span class="n">Amul</span> <span class="o">*</span> <span class="n">Bmul</span> <span class="o">**</span> <span class="p">(</span><span class="n">ZZ</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">trace</span><span class="p">()))</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;D0 = p**(</span><span class="si">%s</span><span class="s2">) * (</span><span class="si">%s</span><span class="s2">) * (</span><span class="si">%s</span><span class="s2">).exp()&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Dval</span><span class="p">,</span> <span class="n">Dmul</span><span class="p">,</span> <span class="n">Dlog</span><span class="p">),</span> <span class="n">outfile</span><span class="p">)</span>

        <span class="n">Fp</span> <span class="o">=</span> <span class="n">Alog</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
        <span class="n">TFp</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">change_ring</span><span class="p">(</span><span class="n">Fp</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">p_adic_l_invariant_additive</span><span class="p">(</span><span class="n">Alog</span><span class="p">,</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">Aval</span><span class="p">,</span> <span class="n">Bval</span><span class="p">,</span> <span class="n">TFp</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">take_to_Qp</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">take_to_Qp</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">Lp</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">T</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;a = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">a</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;b = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">b</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;Lp = Matrix(2,2,</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">Lp</span><span class="o">.</span><span class="n">list</span><span class="p">()),</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">recognize_invariants</span><span class="p">:</span>
            <span class="n">K0</span> <span class="o">=</span> <span class="n">Qq</span><span class="p">(</span><span class="n">Pnrm</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">K0</span><span class="p">(</span><span class="n">take_to_Qp</span><span class="p">(</span><span class="n">Pnrm</span><span class="o">**</span><span class="n">Aval</span> <span class="o">*</span> <span class="n">Alog</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span> <span class="o">*</span> <span class="n">Amul</span><span class="p">))</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">K0</span><span class="p">(</span><span class="n">take_to_Qp</span><span class="p">(</span><span class="n">Pnrm</span><span class="o">**</span><span class="n">Bval</span> <span class="o">*</span> <span class="n">Blog</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span> <span class="o">*</span> <span class="n">Bmul</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">param_dict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s2">&quot;list_I10&quot;</span><span class="p">):</span>
                <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;list_I10&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generate_listI10</span><span class="p">(</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">ideal_p</span> <span class="o">*</span> <span class="n">G</span><span class="o">.</span><span class="n">discriminant</span> <span class="o">*</span> <span class="n">G</span><span class="o">.</span><span class="n">level</span>
                <span class="p">)</span>
            <span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;outfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outfile</span>
            <span class="n">find_igusa_invariants_from_AB</span><span class="p">(</span>
                <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">scaling</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="n">G</span><span class="o">.</span><span class="n">_F_to_local</span><span class="p">,</span> <span class="o">**</span><span class="n">param_dict</span>
            <span class="p">)</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="s2">&quot;# DONE WITH COMPUTATION&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;DONE&quot;</span></div>



<div class="viewcode-block" id="all_possible_ordmats">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.all_possible_ordmats">[docs]</a>
<span class="k">def</span> <span class="nf">all_possible_ordmats</span><span class="p">(</span><span class="n">Lpmat</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">*</span> <span class="n">t</span> <span class="o">==</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span>
        <span class="n">logmat</span> <span class="o">=</span> <span class="n">M</span> <span class="o">*</span> <span class="n">Lpmat</span>
        <span class="k">if</span> <span class="n">logmat</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">():</span>
            <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">(),</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">(),</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()]))</span></div>



<div class="viewcode-block" id="jacobian_matrix">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.jacobian_matrix">[docs]</a>
<span class="k">def</span> <span class="nf">jacobian_matrix</span><span class="p">(</span><span class="n">fvec</span><span class="p">):</span>
    <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span> <span class="o">=</span> <span class="n">fvec</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">f1</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">f1</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
            <span class="n">f1</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>
            <span class="n">f2</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">f2</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
            <span class="n">f2</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>
            <span class="n">f3</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">f3</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
            <span class="n">f3</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="compute_lvec_and_Mlist">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.compute_lvec_and_Mlist">[docs]</a>
<span class="k">def</span> <span class="nf">compute_lvec_and_Mlist</span><span class="p">(</span><span class="n">prec</span><span class="p">):</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">PowerSeriesRing</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="n">num_gens</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">default_prec</span><span class="o">=</span><span class="n">prec</span><span class="p">)</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="p">()</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">Theta</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="n">prec</span><span class="p">)</span>
    <span class="n">lvec</span> <span class="o">=</span> <span class="n">lambdavec</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span> <span class="n">prec_pseries</span><span class="o">=</span><span class="n">prec</span><span class="p">)</span>
    <span class="n">Mlist</span> <span class="o">=</span> <span class="n">compute_twisted_jacobian_data</span><span class="p">(</span><span class="n">lvec</span><span class="p">)</span>
    <span class="n">lvec</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">polynomial</span><span class="p">()</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">lvec</span><span class="o">.</span><span class="n">list</span><span class="p">()]</span>
    <span class="n">save</span><span class="p">((</span><span class="n">lvec</span><span class="p">,</span> <span class="n">Mlist</span><span class="p">),</span> <span class="s2">&quot;lvec_and_Mlist_</span><span class="si">%s</span><span class="s2">.sobj&quot;</span> <span class="o">%</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">lvec</span><span class="p">,</span> <span class="n">Mlist</span><span class="p">)</span></div>



<div class="viewcode-block" id="load_lvec_and_Mlist">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.load_lvec_and_Mlist">[docs]</a>
<span class="k">def</span> <span class="nf">load_lvec_and_Mlist</span><span class="p">(</span><span class="n">prec</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">lvec</span><span class="p">,</span> <span class="n">Mlist</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="s2">&quot;lvec_and_Mlist_</span><span class="si">%s</span><span class="s2">.sobj&quot;</span> <span class="o">%</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">lvec</span><span class="p">,</span> <span class="n">Mlist</span> <span class="o">=</span> <span class="n">compute_lvec_and_Mlist</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">lvec</span><span class="p">,</span> <span class="n">Mlist</span><span class="p">)</span></div>



<div class="viewcode-block" id="evaluate_twisted_jacobian_matrix">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.evaluate_twisted_jacobian_matrix">[docs]</a>
<span class="k">def</span> <span class="nf">evaluate_twisted_jacobian_matrix</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">Mlist</span><span class="p">):</span>
    <span class="n">retvec</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
        <span class="n">retvec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Mlist</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">))</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">Mlist</span><span class="p">[</span><span class="mi">6</span><span class="p">](</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">Mlist</span><span class="p">[</span><span class="mi">7</span><span class="p">](</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>
    <span class="n">h3</span> <span class="o">=</span> <span class="n">Mlist</span><span class="p">[</span><span class="mi">8</span><span class="p">](</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p3</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">ll</span> <span class="o">*</span> <span class="n">h1</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">ll</span> <span class="o">*</span> <span class="n">h2</span>
    <span class="n">h3</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">Mlist</span><span class="p">[</span><span class="mi">9</span><span class="p">](</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span> <span class="o">+</span> <span class="n">ll</span> <span class="o">*</span> <span class="n">h3</span>
    <span class="n">retvec</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">h3</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">retvec</span><span class="p">)</span></div>



<div class="viewcode-block" id="compute_twisted_jacobian_data">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.compute_twisted_jacobian_data">[docs]</a>
<span class="k">def</span> <span class="nf">compute_twisted_jacobian_data</span><span class="p">(</span><span class="n">fvec</span><span class="p">):</span>
    <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span> <span class="o">=</span> <span class="n">fvec</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">()</span>
    <span class="n">Mlist</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">o</span><span class="o">.</span><span class="n">polynomial</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">f1</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">f1</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
            <span class="n">f1</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>
            <span class="n">f2</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">f2</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
            <span class="n">f2</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>
            <span class="n">f3</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">f3</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
            <span class="n">f3</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">f3</span><span class="o">.</span><span class="n">polynomial</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">Mlist</span></div>



<div class="viewcode-block" id="find_initial_approx">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.find_initial_approx">[docs]</a>
<span class="k">def</span> <span class="nf">find_initial_approx</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">L3</span><span class="p">,</span> <span class="n">lvec</span><span class="p">):</span>
    <span class="c1"># Evaluates a matrix M with entries in Z[[x,y,z]] at points x0,y0,z0</span>
    <span class="k">def</span> <span class="nf">ev</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">lvec</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">),</span>
            <span class="n">lvec</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">),</span>
            <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">z0</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">lvec</span><span class="p">[</span><span class="mi">2</span><span class="p">](</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="n">K</span> <span class="o">=</span> <span class="n">L1</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
    <span class="n">n_tries</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">V</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">base</span><span class="p">()</span><span class="o">.</span><span class="n">prime</span><span class="p">()),</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">n_tries</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">n_tries</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n_tries = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n_tries</span><span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">K</span><span class="o">.</span><span class="n">gen</span><span class="p">()</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">K</span><span class="o">.</span><span class="n">base</span><span class="p">()</span><span class="o">.</span><span class="n">gen</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">V</span><span class="p">]</span>
        <span class="n">FP</span> <span class="o">=</span> <span class="n">ev</span><span class="p">(</span><span class="o">*</span><span class="n">P</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">([(</span><span class="n">u</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">FP</span><span class="p">,</span> <span class="p">[</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">L3</span><span class="p">])])</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">good_P</span> <span class="o">=</span> <span class="n">P</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="p">[(</span><span class="n">u</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">FP</span><span class="p">,</span> <span class="p">[</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">L3</span><span class="p">])])</span>
    <span class="k">return</span> <span class="n">good_P</span></div>



<span class="c1"># given a triple of lambda&#39;s returns the corresponding half periods</span>
<div class="viewcode-block" id="HalfPeriodsInTermsOfLambdas">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.HalfPeriodsInTermsOfLambdas">[docs]</a>
<span class="k">def</span> <span class="nf">HalfPeriodsInTermsOfLambdas</span><span class="p">(</span>
    <span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">L3</span><span class="p">,</span> <span class="n">lvec_and_Mlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">HP0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_iters</span><span class="o">=</span><span class="mi">20</span>
<span class="p">):</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">L1</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
    <span class="n">L0</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">L3</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">lvec_and_Mlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">prec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">lvec</span><span class="p">,</span> <span class="n">Mlist</span> <span class="o">=</span> <span class="n">load_lvec_and_Mlist</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lvec</span><span class="p">,</span> <span class="n">Mlist</span> <span class="o">=</span> <span class="n">lvec_and_Mlist</span>

    <span class="c1"># Evaluates a matrix M with entries in Z[[x,y,z]] at points x0,y0,z0</span>
    <span class="k">def</span> <span class="nf">ev</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">lvec</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">),</span>
            <span class="n">lvec</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">),</span>
            <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">z0</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">lvec</span><span class="p">[</span><span class="mi">2</span><span class="p">](</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="k">if</span> <span class="n">HP0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">HP0</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">K</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
    <span class="n">Pn</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">HP0</span><span class="p">)</span>  <span class="c1"># 0th approximation</span>
    <span class="n">n_iters</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">n_iters</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
        <span class="n">n_iters</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">Jinv</span> <span class="o">=</span> <span class="n">evaluate_twisted_jacobian_matrix</span><span class="p">(</span><span class="o">*</span><span class="n">Pn</span><span class="o">.</span><span class="n">list</span><span class="p">(),</span> <span class="n">Mlist</span><span class="o">=</span><span class="n">Mlist</span><span class="p">)</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>
        <span class="n">FPn</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ev</span><span class="p">(</span><span class="o">*</span><span class="n">Pn</span><span class="o">.</span><span class="n">list</span><span class="p">()))</span>
        <span class="n">Pnn</span> <span class="o">=</span> <span class="n">Pn</span> <span class="o">-</span> <span class="n">Jinv</span> <span class="o">*</span> <span class="p">(</span><span class="n">FPn</span> <span class="o">-</span> <span class="n">L0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">n_iters</span><span class="p">,</span>
            <span class="p">[(</span><span class="n">u</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Pn</span><span class="o">.</span><span class="n">list</span><span class="p">(),</span> <span class="n">Pnn</span><span class="o">.</span><span class="n">list</span><span class="p">())],</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">u</span> <span class="o">==</span> <span class="n">v</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Pn</span><span class="o">.</span><span class="n">list</span><span class="p">(),</span> <span class="n">Pnn</span><span class="o">.</span><span class="n">list</span><span class="p">())]):</span>
            <span class="k">return</span> <span class="n">Pn</span>
        <span class="n">Pn</span> <span class="o">=</span> <span class="n">Pnn</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Does not converge&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="normalize_periods">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.normalize_periods">[docs]</a>
<span class="k">def</span> <span class="nf">normalize_periods</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    alpha = (phi1, theta1)</span>
<span class="sd">    beta = (phi2, theta2) = -n(T) * alpha, where T is the Hecke</span>
<span class="sd">    operator used when computing A and B.</span>
<span class="sd">    T is the new hecke operator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># fwrite(&#39;# The following are the canonical periods (using T_ell):&#39;, outfile)</span>
    <span class="n">nm</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">determinant</span><span class="p">()</span>
    <span class="n">newA</span> <span class="o">=</span> <span class="n">A</span> <span class="o">**</span> <span class="n">ZZ</span><span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">*</span> <span class="n">nm</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span> <span class="o">**</span> <span class="n">ZZ</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span>
    <span class="n">new_norm</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">determinant</span><span class="p">())</span>
    <span class="n">new_trace</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">T</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span>
    <span class="n">newB</span> <span class="o">=</span> <span class="n">B</span><span class="o">**-</span><span class="n">new_norm</span>
    <span class="n">newD</span> <span class="o">=</span> <span class="n">newA</span> <span class="o">**</span> <span class="n">ZZ</span><span class="p">(</span><span class="o">-</span><span class="n">new_norm</span><span class="p">)</span> <span class="o">*</span> <span class="n">newB</span> <span class="o">**</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">new_trace</span><span class="p">)</span>

    <span class="c1"># fwrite(&#39;A = %s&#39;%newA, outfile)</span>
    <span class="c1"># fwrite(&#39;B = %s&#39;%newB, outfile)</span>
    <span class="c1"># fwrite(&#39;D = %s&#39;%newD, outfile)</span>
    <span class="c1"># fwrite(&#39;final_scaling = %s * scaling&#39;%-nm*b,outfile)</span>
    <span class="k">return</span> <span class="n">newA</span><span class="p">,</span> <span class="n">newB</span><span class="p">,</span> <span class="n">newD</span><span class="p">,</span> <span class="o">-</span><span class="n">nm</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">alpha</span></div>



<div class="viewcode-block" id="change_period_logs">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.change_period_logs">[docs]</a>
<span class="k">def</span> <span class="nf">change_period_logs</span><span class="p">(</span><span class="n">Alog</span><span class="p">,</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="n">c00</span><span class="p">,</span> <span class="n">c01</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span> <span class="n">c11</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">y</span><span class="p">),</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span> <span class="o">-</span> <span class="n">x</span> <span class="o">*</span> <span class="n">t</span><span class="p">])</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="n">Alog</span><span class="p">,</span> <span class="n">Blog</span> <span class="o">=</span> <span class="n">c00</span> <span class="o">*</span> <span class="n">Alog</span> <span class="o">+</span> <span class="n">c01</span> <span class="o">*</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">c10</span> <span class="o">*</span> <span class="n">Alog</span> <span class="o">+</span> <span class="n">c11</span> <span class="o">*</span> <span class="n">Blog</span>
    <span class="n">Dlog</span> <span class="o">=</span> <span class="n">Alog</span> <span class="o">+</span> <span class="n">T</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span> <span class="o">*</span> <span class="n">Blog</span>
    <span class="k">return</span> <span class="n">Alog</span><span class="p">,</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">Dlog</span></div>



<div class="viewcode-block" id="compare_AB_periods">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.compare_AB_periods">[docs]</a>
<span class="k">def</span> <span class="nf">compare_AB_periods</span><span class="p">(</span><span class="n">Alist</span><span class="p">,</span> <span class="n">Blist</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Ag</span><span class="p">,</span> <span class="n">Bg</span><span class="p">,</span> <span class="n">Dg</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">QQ</span><span class="p">,</span> <span class="n">matlist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">Alist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">base</span><span class="p">()</span><span class="o">.</span><span class="n">prime</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">gen</span><span class="p">()</span>
    <span class="n">K0</span> <span class="o">=</span> <span class="n">Qq</span><span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">QuadExt</span><span class="p">(</span><span class="n">K0</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">deg</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">NumberField</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">charpoly</span><span class="p">(),</span> <span class="n">names</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">matlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">matlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">determinant</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">matlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="n">pairs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;len(Alist) = </span><span class="si">%s</span><span class="s2">, len(Blist) = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Alist</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Blist</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">pu</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">charpoly</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">()[:</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">L</span><span class="o">.</span><span class="n">elements_of_bounded_height</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_integral</span><span class="p">()</span>
        <span class="p">],</span>
        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">(),</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()),</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">u</span><span class="o">.</span><span class="n">charpoly</span><span class="p">()</span><span class="o">.</span><span class="n">is_irreducible</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ZZ</span><span class="p">(</span><span class="n">pu</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="n">ZZ</span><span class="p">(</span><span class="n">pu</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">pairs</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">A0</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">Alist</span><span class="p">,</span> <span class="n">Blist</span><span class="p">,</span> <span class="n">matlist</span><span class="p">):</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
            <span class="n">A1log</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">A0</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">B0</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">B1log</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">A0</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">B0</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">D1log</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span> <span class="o">*</span> <span class="n">A1log</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">B1log</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">A1log</span> <span class="o">-</span> <span class="n">Ag</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">2</span>
                <span class="ow">and</span> <span class="p">(</span><span class="n">B1log</span> <span class="o">-</span> <span class="n">Bg</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">2</span>
                <span class="ow">and</span> <span class="p">(</span><span class="n">D1log</span> <span class="o">-</span> <span class="n">Dg</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">valuation</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">2</span>
            <span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span></div>



<div class="viewcode-block" id="generate_listI10">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.generate_listI10">[docs]</a>
<span class="k">def</span> <span class="nf">generate_listI10</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a list of possible I10&#39;s, of the form:</span>

<span class="sd">    (+-1) * 2^i * u^j * p^k * N^2</span>

<span class="sd">    where i is taken in a specific range(20,25)</span>
<span class="sd">    and j is taken in another range(-15,16)</span>
<span class="sd">    and p is taken in another range(3)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>

    <span class="n">range_twopows</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
    <span class="n">range_units</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">range_conductor</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">range_smallprimes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">factor_list</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span><span class="n">F</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">F</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">units</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">gens_reduced</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">N</span><span class="o">.</span><span class="n">factor</span><span class="p">()]</span>
    <span class="p">)</span>
    <span class="n">exp_ranges</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span><span class="n">range_twopows</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="o">+</span> <span class="p">[</span><span class="n">range_units</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">F</span><span class="o">.</span><span class="n">units</span><span class="p">()]</span>
        <span class="o">+</span> <span class="p">[</span><span class="n">range_conductor</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">N</span><span class="o">.</span><span class="n">factor</span><span class="p">()]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">ell</span> <span class="ow">in</span> <span class="n">F</span><span class="o">.</span><span class="n">primes_of_bounded_norm</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">factor_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ell</span><span class="o">.</span><span class="n">gens_reduced</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">exp_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">range_smallprimes</span><span class="p">)</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">exp_ranges</span><span class="p">):</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prod</span><span class="p">([</span><span class="n">o</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">factor_list</span><span class="p">,</span> <span class="n">v</span><span class="p">)]))</span>
    <span class="k">return</span> <span class="n">ans</span></div>



<div class="viewcode-block" id="find_kadziela_matrices">
<a class="viewcode-back" href="../../highlevel.html#darmonpoints.padicperiods.find_kadziela_matrices">[docs]</a>
<span class="k">def</span> <span class="nf">find_kadziela_matrices</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The matrix M describes the relation between periods (A,B,D)^t</span>
<span class="sd">    and the periods (A0,B0)^t, where (A,B,D) are the periods of</span>
<span class="sd">    the Teitelbaum periods, and (A0,B0) are the Darmon ones.</span>
<span class="sd">           (A,B,D)^t = M * (A0,B0)^t</span>
<span class="sd">    The matrix T describes the action of Hecke on homology.</span>
<span class="sd">    That is, the first column of T describes the image of T</span>
<span class="sd">    on the first basis vector.</span>

<span class="sd">    The output are matrices X and Y such that</span>
<span class="sd">         X * matrix(2,2,[A,B,B,D]) = matrix(2,2,[A0,B0,C0,D0]) * Y</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="c1">#     1,  2,  3,  4,  5,  6,  7,  8</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">r3</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">r4</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r5</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">r6</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">r7</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r8</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">d</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">t</span><span class="p">]</span>
    <span class="n">AA</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span><span class="p">,</span> <span class="n">r4</span><span class="p">,</span> <span class="n">r5</span><span class="p">,</span> <span class="n">r6</span><span class="p">,</span> <span class="n">r7</span><span class="p">,</span> <span class="n">r8</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">AA</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Not isogenous&quot;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">AA</span><span class="o">.</span><span class="n">right_kernel</span><span class="p">()</span><span class="o">.</span><span class="n">matrix</span><span class="p">()</span><span class="o">.</span><span class="n">rows</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">r</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span></div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2016-2024, Marc Masdeu
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=4b9d3a76"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>